```
title: "FlxSave"
apiPath: util/FlxSave.html
```

```haxe
import flixel.util.FlxSave;
```

HaxeFlixel предоставляет использование класса `FlxSave` для загрузки и сохранения состояния вашей игры. Его можно использовать для загрузки и сохранения таблицы лидеров, позиций и статуса игрока и врагов, либо настроек, которые выбрал пользователь. `FlxSave` поддерживается на всех платформах (как и большинство функций в HaxeFlixel).

Чтобы использовать `FlxSave`, вам нужно добавить переменную в этот класс. Вы можете использовать собственную переменную (это возможно сделать как в главном классе, так и в `FlxState`, либо как локальную переменную в функциях save/load). Также вы можете использовать встроенную переменную, которую сам использует HaxeFlixel (`FlxG.save`).

Пример ниже взят из [демо-проекта сохранения в HaxeFlixel](http://haxeflixel.com/demos/Save/). Если у вас уже установлен HaxeFlixel, для установки демо проектов введите в командной строке `haxelib install flixel-demos` или [скачайте исходники через GitHub](https://github.com/HaxeFlixel/flixel-demos/tree/master/Features/Save/source).

#### Saving

Рассмотрим пример для сохранения данных игры. Как только вы создали переменную для хранения, необходимо ее инициализировать и забиндить:

``` haxe
_gameSave = new FlxSave(); // initialize
_gameSave.bind("SaveDemo"); // bind to the named save slot
```

Обратите внимание на строку "SaveDemo". Под этим именем HaxeFlixel определяет слот для хранения в локальном хранилище. Если вам нужно несколько слотов для хранения, определите несколько имен для каждого слота, например "SaveSlot1", "SaveSlot2" и т.д., не забудьте забиндить все имена.

Если вы хотите использовать фронтенд `FlxG.save`, то можете пропустить шаги выше, т.к. HaxeFlixel делает их автоматически.

После инициализации, сохранение готово к использованию. Чтобы сделать сохранение, используйте свойство .data, обращаясь к нему как к [Dynamic](https://haxe.org/manual/types-dynamic.html):

``` haxe
_gameSave.data.boxPositions = new Array<FlxPoint>();
_gameSave.data.boxPositions.push(box.getPosition());

_gameSave.data.enemy = myEnemy;

// сохраняем данные
_gameSave.flush();
```

##### flush()
Немедленно записывает данные из памяти на диск.
**Обязателен для всех платформ, кроме Flash**

##### Сериализация

В некоторых случаях вам может потребоваться [сериализовать и десериализовать](https://haxe.org/manual/std-serialization.html) ваши данные (говоря более простым языком, "взять данные и преобразовать их в специальную строку и обратно) чтобы избежать ошибок. Однако если не возникает ошибок, вы можете попробовать сохранение без сериализации.

#### Загрузка

Чтобы получить сохраненные данные, вам необходимо иметь проинициализированный `FlxSave` и прочитать каждое значение из свойства .data.

``` haxe
var position = _gameSave.data.boxPositions[tempCount];
box.setPosition(position.x, position.y);
```

Таким образом, вам необходимо через цикл пройтись по каждому свойству в .data и присвоить их значения нужной переменной в вашем коде.

#### Existing save data

Когда вы сохраняете данные в заданный слот `FlxSave`, возможно, что в этом слоте уже есть данные. Чтобы проверить это - необходимо проверить одну из созданный переменных на null. Если сохраненные данные уже имеются, перед новым сохранением желательно стереть все предыдущие данные, чтобы значения свойств из предыдущего сохранения не остались в текущем сохранении. Чтобы это сделать можно каждое свойство сбросить в null (или дефолтное значение) или вы можете стереть данные полностью (вероятно, не лучшй способ при использовании `FlxG.save`).

`FlxSave` имеет метод `.erase()`, который немедленно очищает все данные в .data, оставляет слот в очищенном состоянии (предыдущие данные полностью удалятся), а также удаляет бинд для слота сохранения. Последнее очень важно помнить, т.к. после удаления бинда `FlxSave` может все еще давать возможность обращаться к .data и даже вызывать другие методы без каких-либо нотификаций и том, что эти данные не сохранятся. Поэтому, если вы используете метод `.erase()`, не забывайте затем снова вызывать `.bind()` до того, как вы запишите или загрузите новые данные.

#### Other methods

В демо-проекте приложение создает и биндит переменную в `FlxSave` когда инициализируется начальное состояние `PlayState` в методе `create()`. Оттуда эта переменная доступна для загрузки и сохранения. Это позволяет постоянно обновлять объект сохранения, когда это необходимо. Также верно создавать, инициализировать и биндить переменную в FlxSave только при загрузке и сохранении. В этом случае вам следует ознакомиться с методами `.close ()` и `.destroy ()` для безопасной и эффективной обработки вашего `FlxSave`.

Дополнительные методы и функционал класса `FlxSave` доступен в [документации](http://api.haxeflixel.com/flixel/util/FlxSave.html). Также вы можете самостоятельно ознакомиться с определением класса `FlxSave` (пакет flixel.utils).
